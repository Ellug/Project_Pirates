name: Discord Notification
on:
  push:
    branches: [ "main", "master", "develop" ]
  pull_request:
    types: [opened, closed]

jobs:
  discord-notify:
    runs-on: ubuntu-latest
    env:
      # ê¹ƒí—ˆë¸Œ ì‹œí¬ë¦¿ì— ë“±ë¡í•œ ì›¹í›… ì£¼ì†Œ (í•„ìˆ˜ í™•ì¸!)
      DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # ---------------------------------------------------
      # 1. PUSH ë°œìƒ ì‹œ (íŒŒë€ìƒ‰)
      # ---------------------------------------------------
      - name: Discord Notification - Push
        if: github.event_name == 'push'
        run: |
          # JSON ë°ì´í„° ì¡°ë¦½ (ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì œ ë°©ì§€ë¥¼ ìœ„í•´ jq ì‚¬ìš© ê¶Œì¥í•˜ì§€ë§Œ ê°„ë‹¨íˆ ë³€ìˆ˜ë¡œ ì²˜ë¦¬)
          COMMIT_MSG=$(echo "${{ github.event.head_commit.message }}" | sed 's/"/\\"/g' | head -n 1)
          
          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"username\": \"ê¹ƒí—ˆë¸Œ ìƒí™©ì‹¤\",
            \"avatar_url\": \"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\",
            \"embeds\": [{
              \"title\": \"ğŸš€ ìƒˆë¡œìš´ ì½”ë“œê°€ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤!\",
              \"description\": \"**ë¸Œëœì¹˜:** \`${{ github.ref_name }}\`\\n**ì‘ì„±ì:** ${{ github.actor }}\\n**ë©”ì‹œì§€:** $COMMIT_MSG\",
              \"color\": 3447003,
              \"url\": \"${{ github.event.compare }}\"
            }]
          }" \
          $DISCORD_WEBHOOK

      # ---------------------------------------------------
      # 2. PR ìƒì„± ì‹œ (ì´ˆë¡ìƒ‰)
      # ---------------------------------------------------
      - name: Discord Notification - PR Opened
        if: github.event_name == 'pull_request' && github.event.action == 'opened'
        run: |
          PR_TITLE=$(echo "${{ github.event.pull_request.title }}" | sed 's/"/\\"/g')
          
          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"username\": \"PR ì•Œë¦¬ë¯¸\",
            \"avatar_url\": \"https://git-scm.com/images/logos/downloads/Git-Icon-1788C.png\",
            \"embeds\": [{
              \"title\": \"ğŸ”€ í’€ ë¦¬í€˜ìŠ¤íŠ¸(PR)ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤!\",
              \"description\": \"**ìš”ì²­ì:** ${{ github.actor }}\\n**ë‚´ìš©:** $PR_TITLE\\n**ê²½ë¡œ:** \`${{ github.head_ref }}\` â†’ \`${{ github.base_ref }}\`\\n\\n[PR ë³´ëŸ¬ê°€ê¸°](${{ github.event.pull_request.html_url }})\",
              \"color\": 5763719
            }]
          }" \
          $DISCORD_WEBHOOK

      # ---------------------------------------------------
      # 3. ë³‘í•©(Merge) ì™„ë£Œ ì‹œ (ë³´ë¼ìƒ‰)
      # ---------------------------------------------------
      - name: Discord Notification - Merged
        if: github.event.pull_request.merged == true
        run: |
          PR_TITLE=$(echo "${{ github.event.pull_request.title }}" | sed 's/"/\\"/g')
          
          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"username\": \"ë³‘í•© ì™„ë£Œë´‡\",
            \"avatar_url\": \"https://cdn-icons-png.flaticon.com/512/8832/8832108.png\",
            \"embeds\": [{
              \"title\": \"âœ… ë³‘í•©(Merge)ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\",
              \"description\": \"**ë³‘í•©í•œ ì‚¬ëŒ:** ${{ github.actor }}\\n**ë³‘í•©ëœ PR:** $PR_TITLE\\n**ê²°ê³¼:** \`${{ github.head_ref }}\` ë‚´ìš©ì´ \`${{ github.base_ref }}\`ì— ë°˜ì˜ë¨.\",
              \"color\": 10181046,
              \"url\": \"${{ github.event.pull_request.html_url }}\"
            }]
          }" \
          $DISCORD_WEBHOOK